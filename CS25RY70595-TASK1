import tkinter as tk
from tkinter import scrolledtext
import re
import random
from datetime import datetime

class NexiChatbotGUI:
    def __init__(self, root):
        self.user_name = None

        # Regex based intent recognition
        self.patterns = {
            "greeting": r"\b(hi|hello|hey|greetings)\b",
            "goodbye": r"\b(bye|goodbye|exit|quit)\b",
            "name": r"\b(what is your name|who are you|your name)\b",
            "how_are_you": r"\b(how are you|how's it going)\b",
            "thanks": r"\b(thanks|thank you|appreciate it)\b",
            "weather": r"\b(weather|temperature|climate)\b",
            "identity": r"\b(what can you do|tell me about yourself|who built you)\b",
            "time": r"\b(what time is it|current time|time now)\b",
            "joke": r"\b(tell me a joke|make me laugh|say something funny)\b",
            "motivate": r"\b(motivate me|i need motivation|inspire me)\b"
        }

        # Responses mapped to intents
        self.responses = {
            "greeting": [
                "Hi there. It's good to see you.",
                "Hello! How can I help you today?",
                "Hey, glad you're here."
            ],
            "goodbye": [
                "Goodbye. It was nice chatting.",
                "See you later.",
                "Ending session. Take care."
            ],
            "name": [
                "I'm Nexi, your personal chat assistant.",
                "You can call me Nexi."
            ],
            "how_are_you": [
                "I'm doing well, thanks for asking. What about you?",
                "I'm stable. Always here to assist."
            ],
            "thanks": [
                "You're welcome.",
                "No problem.",
                "Anytime."
            ],
            "weather": [
                "I can't fetch live weather right now, but it's always sunny here in code land."
            ],
            "identity": [
                "I'm Nexi, designed to assist and chat with you.",
                "I'm a rule-based chatbot built to keep you company."
            ],
            "time": [
                f"The current time is {datetime.now().strftime('%I:%M %p')}."
            ],
            "joke": [
                "Why do programmers prefer dark mode? Because light attracts bugs.",
                "There are 10 kinds of people: those who understand binary and those who don’t.",
                "Why did the computer go to therapy? It had a hard drive."
            ],
            "motivate": [
                "You’re capable of amazing things.",
                "Keep going. You're doing great.",
                "Every expert was once a beginner."
            ],
            "default": [
                "Hmm, I didn’t get that. Try asking something else.",
                "Can you rephrase that?",
                "Interesting... tell me more?"
            ]
        }

        self.root = root
        self.root.title("Nexi - Chat Assistant")
        self.root.geometry("500x600")
        self.root.resizable(False, False)

        # Chat display area
        self.chat_area = scrolledtext.ScrolledText(root, wrap=tk.WORD, font=("Arial", 12))
        self.chat_area.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)
        self.chat_area.config(state=tk.DISABLED)

        # Input field
        self.entry = tk.Entry(root, font=("Arial", 12))
        self.entry.pack(fill=tk.X, padx=10, pady=(0, 10))
        self.entry.bind("<Return>", self.handle_user_input)

        self.print_to_chat("Nexi", "Hello there. I'm Nexi. What's your name?")

    def print_to_chat(self, sender, message):
        self.chat_area.config(state=tk.NORMAL)
        self.chat_area.insert(tk.END, f"{sender}: {message}\n")
        self.chat_area.config(state=tk.DISABLED)
        self.chat_area.yview(tk.END)

    def get_intent(self, user_input):
        for intent, pattern in self.patterns.items():
            if re.search(pattern, user_input, re.IGNORECASE):
                return intent
        return "default"

    def generate_response(self, user_input):
        intent = self.get_intent(user_input)
        return random.choice(self.responses[intent])

    def handle_user_input(self, event):
        user_input = self.entry.get().strip()
        if not user_input:
            return

        self.print_to_chat("You", user_input)
        self.entry.delete(0, tk.END)

        if self.user_name is None:
            self.user_name = user_input.split()[0].capitalize()
            self.print_to_chat("Nexi", f"Nice to meet you, {self.user_name}. Feel free to ask me anything.")
        else:
            response = self.generate_response(user_input)
            self.print_to_chat("Nexi", response)

            if self.get_intent(user_input) == "goodbye":
                self.entry.config(state=tk.DISABLED)
                self.print_to_chat("Nexi", "Session closed.")

# Run the GUI app
if __name__ == "__main__":
    root = tk.Tk()
    app = NexiChatbotGUI(root)
    root.mainloop()
